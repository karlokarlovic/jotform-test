
<!DOCTYPE html>
<html>
    <head>
        <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    </head>

    <body>
        Name: <input id="account" type="text" name="account" value="12345678">
    </body>

    <script type="text/javascript">

        JFCustomWidgetUtils.domReady(function () {

            function testWidget() {

                var supabaseClient = null;

                // Global variables
                const client_id = JFCustomWidget.getWidgetSetting('client_id');
                const client_secret = JFCustomWidget.getWidgetSetting('client_secret');
                const token_url = "https://mdm.kings.edu.au/api/v1/auth/token"; // Jamf token creation endpoint
                const api_url = "https://mdm.kings.edu.au/JSSResource/sites"; // Data we want to access via the API


                // Exposes functions to external calls
                this.getData = getData;
                this.testingSupabase = testingSupabase;
                this.setSupabaseObject = setSupabaseObject;

                function setSupabaseObject(supabaseObject){
                    this.supabaseClient = supabaseObject;
                }

                async function testingSupabase(){

                    let { data, error } = await supabaseClient.from('Test123').select('*');

                    console.log("Content from supabase table: ", data);

                    this.supabaseClient
                        .from('Test123')
                        .select('*')
                        .then((data, error) => {
                            console.log("Content from supabase table: ", data);
                        });

                    return true;
                }

                function getData() {
                    return {
                        valid: true,
                        value: ""
                    };
                }
            }

            JFCustomWidget.subscribe("ready", function (data) {
                
                // API Related Information
                const supabaseUrl = 'https://wqifzlurfbhlyyjyouyt.supabase.co';
                const supabaseKey = JFCustomWidget.getWidgetSetting('supabase_key');

                const { createClient } = supabase;

                const supabaseClient = createClient(supabaseUrl, supabaseKey);
                console.log("Supabase Instance", supabaseClient);
                
                var widget = new testWidget();
                widget.setSupabaseObject(supabaseClient);
                var data = widget.testingSupabase();


                JFCustomWidget.subscribe("submit", function () {
                    JFCustomWidget.sendSubmit(widget.getData());
                });
            });
        });
    </script>

</html>
